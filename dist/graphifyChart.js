"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t={x:0,y:0,width:100,height:100,fillStyle:"blue",borderColor:"rgba(0,0,0,0)",borderWidth:1,radius:0,zIndex:0},i={x:10,y:10,radius:50,startAngle:0,endAngle:2*Math.PI,fillStyle:"blue",borderColor:"rgba(0,0,0,0)",borderWidth:1,zIndex:0},e={x:10,y:10,fillStyle:"blue",startAngle:0,endAngle:1.5*Math.PI,borderColor:"rgba(0,0,0,0)",borderWidth:1,radius:60,zIndex:0};class s{drag(){this.addEventListener("mousedown",(t=>{t.target&&(this.draging=!0,this.stage.draging=!0,this.dragNodeMoveX=t.x-this.x,this.dragNodeMoveY=t.y-this.y)}));this.stage.container.addEventListener("mousemove",(t=>{this.draging&&(null==this||this.setAttr({x:t.offsetX-this.dragNodeMoveX,y:t.offsetY-this.dragNodeMoveY}))})),this.stage.container.addEventListener("mouseup",(t=>{this.stage.draging=!1,this.draging=!1}))}}let h=0;const r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){let i=+new Date,e=Math.max(1e3/60,1e3/60-(i-h));return h=i+e,setTimeout(t,e)},n=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout,o={linear:function(t,i,e,s){return e*t/s+i},ease:function(t,i,e,s){return-e*((t=t/s-1)*t*t*t-1)+i},"ease-in":function(t,i,e,s){return e*(t/=s)*t*t+i},"ease-out":function(t,i,e,s){return e*((t=t/s-1)*t*t+1)+i},"ease-in-out":function(t,i,e,s){return(t/=s/2)<1?e/2*t*t*t+i:e/2*((t-=2)*t*t+2)+i},bounce:function(t,i,e,s){return(t/=s)<1/2.75?e*(7.5625*t*t)+i:t<2/2.75?e*(7.5625*(t-=1.5/2.75)*t+.75)+i:t<2.5/2.75?e*(7.5625*(t-=2.25/2.75)*t+.9375)+i:e*(7.5625*(t-=2.625/2.75)*t+.984375)+i}};let d=null;class a{constructor(t,i,e){this.canvas=t;const s=t.getBoundingClientRect();this.hitQueue=[],t.addEventListener(e,(t=>{const h=t.clientX-s.left,r=t.clientY-s.top,n=i.quadTree.query(h,r).filter((t=>t.contains(h,r))).sort(((t,i)=>i.index-t.index));this.hitQueue=n[0]?[n[0]]:[],this.bindEvent(h,r,e)}))}bindEvent(t,i,e){let s=!0;const h={target:null,stopPropagation:()=>{s=!1}};this.hitQueue.forEach((r=>{s&&(h.target=r,r.listener[e]&&r.listener[e].forEach((e=>{e({...h,x:t,y:i})})))}))}}class l{constructor(t,i=0,e){this.boundary=t,this.nodes=[],this.divided=!1,this.maxCapacity=10,this.children=[],this.depth=i,this.ctx=e}insertNode(t){if(!this.intersects(t.getBox()))return!1;if(t.depth=this.depth,!this.divided&&this.nodes.length<this.maxCapacity)return this.nodes.push(t),!0;this.divided||this.quadrant();return this.children.map((i=>i.insertNode(t))).some((t=>t))}intersects(t){return!(t.x>this.boundary.x+this.boundary.width||t.x+t.width<this.boundary.x||t.y>this.boundary.y+this.boundary.height||t.y+t.height<this.boundary.y)}quadrant(){const t=this.boundary.x,i=this.boundary.y,e=this.boundary.width/2,s=this.boundary.height/2,h={x:t+e,y:i,width:e,height:s},r={x:t+e,y:i+s,width:e,height:s},n={x:t,y:i+s,width:e,height:s},o={x:t,y:i,width:e,height:s},d=this.ctx;d.beginPath(),d.moveTo(t,i+s),d.lineTo(t+2*e,i+s),d.moveTo(t+e,i),d.lineTo(t+e,i+2*s),d.strokeStyle="red",d.closePath(),d.stroke(),this.children=[new l(h,this.depth+1,this.ctx),new l(r,this.depth+1,this.ctx),new l(n,this.depth+1,this.ctx),new l(o,this.depth+1,this.ctx)],this.divided=!0,this.nodes.forEach((t=>{this.children.forEach(((i,e)=>{i.insertNode(t)}))})),this.nodes=[]}query(t,i,e=[]){return this.containsPoint(t,i)?(e.push(...this.nodes),this.divided&&(this.children[0].query(t,i,e),this.children[1].query(t,i,e),this.children[2].query(t,i,e),this.children[3].query(t,i,e)),e):e}containsPoint(t,i){return t>=this.boundary.x&&t<=this.boundary.x+this.boundary.width&&i>=this.boundary.y&&i<=this.boundary.y+this.boundary.height}}exports.Circle=class extends s{constructor(t,e={}){super(t,e),this.ctx=t.getCtx(),this.stage=t,this.type="circle";for(let s in i)this[s]=(null==e?void 0:e[s])||i[s];this.children=[],this.listener={},this.draging=!1,this.draggable=e.draggable,this.draggable&&this.drag()}contains(t,i){const e=this.x-this.radius,s=this.x+this.radius,h=this.y-this.radius,r=this.y+this.radius;if(!(t>=e&&t<=s&&i>=h&&i<=r))return!1;const n=t-this.x,o=i-this.y;return n*n+o*o<=this.radius*this.radius}getBox(){return{x:this.x-this.radius,y:this.y-this.radius,width:2*this.radius,height:2*this.radius}}setAttr(t){Object.keys(t).forEach((i=>this[i]=t[i])),this.stage.render()}appendChild(...t){t.length>0&&(t.forEach((t=>{this.children.push(t)})),this.stage.render())}addEventListener(t,i){this.listener[t]||(this.listener[t]=[]),this.listener[t].push(i)}render(){const{x:t,y:i,radius:e,startAngle:s,endAngle:h,fillStyle:r,borderColor:n,borderWidth:o}=this,d=this.ctx;d.save(),d.beginPath(),d.arc(t,i,e,s,h),d.fillStyle=r,d.strokeStyle=n||"rgba(0,0,0,0)",d.lineWidth=o,d.fill(),d.stroke(),d.closePath(),d.restore()}},exports.Group=class extends s{constructor(t,i={}){super(t,i),this.ctx=t.getCtx(),this.stage=t,this.type="group",this.x=0,this.y=0,this.children=[],this.listener={},this.childrenPosition=[],this.draging=!1,this.draggable=i.draggable,this.draggable&&this.drag()}contains(t,i){return this.children.some((e=>e.contains(t,i)))}setAttr(t){const{x:i=0,y:e=0}=t;this.x=i,this.y=e,this.children.forEach(((s,h)=>{const r={...t,x:i+this.childrenPosition[h].x,y:e+this.childrenPosition[h].y};s.setAttr(r)})),this.stage.render()}appendChild(...t){t.length>0&&(t.forEach((t=>{this.children.push(t),this.childrenPosition.push({x:t.x,y:t.y})})),this.stage.render())}getBox(){return!0}addEventListener(t,i){this.listener[t]||(this.listener[t]=[]),this.listener[t].push(i)}render(){this.children.length>0&&this.children.sort(((t,i)=>t.zIndex-i.zIndex)).forEach((t=>{t.render()}))}},exports.Line=class{constructor(t,i={}){var e,s,h,r;this.stage=t,this.ctx=t.getCtx(),this.type="line",this.lineType=i.lineType||"line",this.x1=i.x1||0,this.y1=i.y1||0,this.x2=i.x2||100,this.y2=i.y2||100,this.controlX1=null==(e=i.control1)?void 0:e.x,this.controlY1=null==(s=i.control1)?void 0:s.y,this.controlX2=null==(h=i.control2)?void 0:h.x,this.controlY2=null==(r=i.control2)?void 0:r.y,this.borderColor=i.borderColor||"red",this.lineWidth=i.lineWidth,this.lineCap=i.lineCap,this.children=[],this.listener={},this.showControlPoints=i.showControlPoints,this.controlPointColor=i.controlPointColor,this.controlPointRadius=i.controlPointRadius}contains(t,i){return!1}setAttr(t){Object.keys(t).forEach((i=>this[i]=t[i])),this.stage.render()}addEventListener(t,i){this.listener[t]||(this.listener[t]=[]),this.listener[t].push(i)}getBox(){return{x:this.x,y:this.y,width:this.width,height:this.height}}render(){const t=this.ctx;switch(t.save(),t.beginPath(),t.moveTo(this.x1,this.y1),this.lineType){case"quadratic":t.quadraticCurveTo(this.controlX1,this.controlY1,this.x2,this.y2);break;case"cubic":t.bezierCurveTo(this.controlX1,this.controlY1,this.controlX2,this.controlY2,this.x2,this.y2);break;default:t.lineTo(this.x2,this.y2)}t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.stroke(),t.closePath(),t.restore(),this.showControlPoints&&this.drawControlPoints(t)}drawControlPoints(t){const i=[[this.x1,this.y1],[this.x2,this.y2]].map((t=>new Circle(this.stage,{x:t[0],y:t[1],radius:this.controlPointRadius,startAngle:0,endAngle:2*Math.PI,fillStyle:this.controlPointColor,zIndex:2})));this.appendChild(...i)}},exports.Rect=class extends s{constructor(i,e={}){super(i,e),this.ctx=i.getCtx(),this.stage=i,this.type="rect";for(let s in t)this[s]=(null==e?void 0:e[s])||t[s];this.children=[],this.listener={},this.draging=!1,this.draggable=e.draggable,this.draggable&&this.drag()}contains(t,i){return t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height}setAttr(t){Object.keys(t).forEach((i=>this[i]=t[i])),this.stage.render()}addEventListener(t,i){this.listener[t]||(this.listener[t]=[]),this.listener[t].push(i)}getBox(){return{x:this.x,y:this.y,width:this.width,height:this.height}}render(){const{x:t,y:i,width:e,height:s,fillStyle:h,borderColor:r,borderWidth:n,radius:o}=this,d=this.ctx;d.save(),d.fillStyle=h,d.lineWidth=n,d.strokeStyle=r,o?(d.lineWidth=2*n,d.beginPath(),d.moveTo(t+o,i),d.lineTo(t+e-2*o,i),d.arcTo(t+e,i,t+e,i+o,o),d.lineTo(t+e,i+s-o),d.arcTo(t+e,i+s,t+e-o,i+s,o),d.lineTo(t+o,i+s),d.arcTo(t,i+s,t,i+s-o,o),d.lineTo(t,i+o),d.arcTo(t,i,t+o,i,o),d.closePath(),d.stroke(),d.fill()):(d.fillRect(t,i,e,s),d.strokeRect(t,i,e,s)),d.restore()}},exports.Sector=class extends s{constructor(t,i={}){super(t,i),this.stage=t,this.ctx=t.getCtx(),this.type="sector";for(let s in e)this[s]=(null==i?void 0:i[s])||e[s];this.children=[],this.listener={},this.draging=!1,this.draggable=i.draggable,this.draggable&&this.drag()}contains(t,i){const e=t-this.x,s=i-this.y;if(e*e+s*s>this.radius*this.radius)return!1;const h=this.endAngle-this.startAngle;if(Math.abs(h%(2*Math.PI))<1e-6)return!0;let r=Math.atan2(s,e);r=r<0?r+2*Math.PI:r;let n=this.startAngle%(2*Math.PI);n=n<0?n+2*Math.PI:n;let o=this.endAngle%(2*Math.PI);return o=o<0?o+2*Math.PI:o,n<o?r>=n&&r<=o:r>=n||r<=o}setAttr(t){Object.keys(t).forEach((i=>this[i]=t[i])),this.stage.render()}addEventListener(t,i){this.listener[t]||(this.listener[t]=[]),this.listener[t].push(i)}getBox(){return{x:this.x-this.radius,y:this.y-this.radius,width:this.x+this.radius,height:this.y+this.radius}}render(){const t=this.ctx;t.save(),t.beginPath(),t.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle),t.lineTo(this.x,this.y),t.closePath(),t.fillStyle=this.fillStyle,t.fill(),t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.stroke(),t.restore()}},exports.Stage=class{constructor(t,i,e){var s,h;this.container=t;const r=document.createElement("canvas");r.width=i||(null==(s=null==this?void 0:this.container)?void 0:s.clientWidth),r.height=e||(null==(h=null==this?void 0:this.container)?void 0:h.clientHeight);const n=r.getContext("2d");this.container.appendChild(r),this.children=[],this.ctx=n,this.quadTree=new l({x:0,y:0,width:n.canvas.width,height:n.canvas.height},0,this.ctx);["click","mousedown","mouseup","mousemove"].forEach((t=>new a(this.ctx.canvas,this,t))),this.isRendering=!1,this.index=0,this.isQuadTreeUpdate=!1,this.dragNode=null,this.dragNodeMoveX=0,this.dragNodeMoveY=0,this.render(),this.draging=!1}getCtx(){return this.ctx}appendChild(...t){t.forEach((t=>{t.index=this.index,this.index=this.index+1,this.children.push(t)})),this.isQuadTreeUpdate=!0,this.render()}removeChild(t){this.children.splice(t,1),this.isQuadTreeUpdate=!0,this.render()}getChildren(t){if(!t)return this.children||[];const i=this.children||[],e=[];return i.forEach((function(i){t(i)&&e.push(i)})),e}destroyChildren(){return this.getChildren().forEach((t=>{t.parent=null,t.index=0})),this.children=[],this.render(),this}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}hasChildren(){return this.getChildren().length>0}render(){this.isRendering||(this.isRendering=!0,requestAnimationFrame((()=>{if(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.children.sort(((t,i)=>t.zIndex-i.zIndex)).forEach((t=>{t.render()})),this.isQuadTreeUpdate&&!this.draging){let t=0;this.children.forEach((i=>{this.quadTree.insertNode(i),i.children.length>0&&(i.level=t,i.children.forEach((i=>{i.level=t+1,this.quadTree.insertNode(i)})))})),this.isQuadTreeUpdate=!1}this.isRendering=!1})))}},exports.animation=function(t,i,e="linear",s){const h=Date.now();n(d),function n(){const a=Math.min(i,Date.now()-h),l=o[e](a,0,1,i);a<i&&(t.setAttr({[s.attr]:s.value*l}),d=r(n))}()};
